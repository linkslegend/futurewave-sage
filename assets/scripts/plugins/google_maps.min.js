!function(t,o,e){function a(o,e){var a=this;a.$element=t(o),a.id=a.$element.attr("id"),a.options=t.extend({},a.defaults,e),a.init()}var i="map_canvas";a.prototype={defaults:{max_zoom:0,min_zoom:0,map_type:"ROADMAP",direction_color:"#f60",zoom:17},init:function(){var o=this;o.options.mapdata&&(o.$geocoder=new google.maps.Geocoder,t(o.options.mapdata).each(function(t){this.latitude&&this.longitude?(this.latlng=new google.maps.LatLng(this.latitude,this.longitude),o._init_map()):this.street&&this.postal_code&&this.locality&&this.country&&o.$geocoder.geocode({address:this.street+", "+this.postal_code+" "+this.locality+" "+this.country},function(e,a){a===google.maps.GeocoderStatus.OK&&(o.options.mapdata[t].latlng=e[0].geometry.location,o._init_map())})}))},_init_map:function(){var t=this,a=0;for(a;a<t.options.mapdata.length;a++)if(t.options.mapdata[a].latlng===e)return;t.$map=new google.maps.Map(o.getElementById(t.id),{center:t.options.mapdata[0].latlng,mapTypeId:google.maps.MapTypeId[t.options.map_type],scrollwheel:!1,zoom:t.options.zoom}),t.$bounds=new google.maps.LatLngBounds,t._init_directions(),t._init_autoselect(),t._init_travel_mode(),t._init_gelocation(),t._map_resize(),t._set_markers(),t._limit_zoomlevel(),t.options.debug&&google.maps.event.addDomListener(t.$map,"drag",function(){console.log("Center: "+t.$map.getCenter())})},_init_directions:function(){var o=this;o.$saddr=t("#saddr_"+o.id),o.$daddr=t("#daddr_"+o.id),o.$panel=t("#panel_"+o.id),o.$polylines=[],$directions_service=new google.maps.DirectionsService,t("#direction_"+o.id).submit(function(){var a,i=o.$saddr.val(),s=o.$daddr.val();return i.length&&s.length?(a=o.options.mapdata[s].street+", "+o.options.mapdata[s].postal_code+" "+o.options.mapdata[s].locality+", "+o.options.mapdata[s].country,$directions_service.route({origin:i,destination:a,travelMode:"0"===o.$travel_mode.val()?google.maps.DirectionsTravelMode.DRIVING:google.maps.DirectionsTravelMode.WALKING},function(n,r){if(r===google.maps.DirectionsStatus.OK){var d,l,p=n.routes[0],m=p.legs[0],c=m.steps,_=p.warnings,g="";for(o._clean_map(),o.$route_bounds=p.bounds,o.$map.fitBounds(o.$route_bounds),_.length&&(g+='<p class="warnings">'+_+"</p>"),g+='<p class="distance_all">'+m.distance.text+" - "+m.duration.text+"</p>",g+="<table>",g+="<tr>",g+='<td class="step">1.</td>',g+='<td class="start_address">'+m.start_address+"</td>",g+="<td></td>",g+="</tr>",l=0;l<c.length;l++)g+="<tr>",g+='<td class="step">'+(l+2)+".</td>",g+='<td class="instructions">'+c[l].instructions.replace(/ style=.+"/gi,"").replace("<div>","<div><small>").replace("</div>","</small></div>")+"</td>",g+='<td class="distance">'+c[l].distance.text+"</td>",g+="</tr>",d=new google.maps.Polyline({path:c[l].path,strokeColor:o.options.direction_color,strokeOpacity:.8,strokeWeight:5}),d.setMap(o.$map),o.$polylines.push(d);g+="<tr>",g+='<td class="step">'+(l+2)+".</td>",g+='<td class="start_address">'+m.end_address+"</td>",g+="<td></td>",g+="</tr>",g+="</table>",g+='<p class="copyright"><small>'+p.copyrights+"</small></p>","object"==typeof o.$start_marker&&o.$start_marker.setMap(null),o.$start_marker=new google.maps.Marker({clickable:!1,icon:o.options.start_marker_href?{url:o.options.start_marker_href,scaledSize:new google.maps.Size(o.options.start_marker_width,o.options.start_marker_height)}:e,map:o.$map,optimized:!1,position:m.start_location}),t(o.options.mapdata).each(function(){this.$marker.setVisible(!1)}),o.options.mapdata[s].$marker.setVisible(!0),device.ios()?location.href="maps://maps.google.com/maps?saddr="+i+"&daddr="+a:device.ios()||!device.mobile()&&!device.tablet()?o.$panel.empty().append(t(g)):location.href="https://maps.google.com/maps?saddr="+i+"&daddr="+a}})):o.$panel.empty(),!1})},_clean_map:function(){var o=this;t(o.$polylines).each(function(){this.setMap(null)}),o.$polylines=[]},_init_autoselect:function(){var o=this;o.$daddr.change(function(){var e=t(this).children("option:selected").val();o._clean_map(),o.$route_bounds="","object"==typeof o.$start_marker&&o.$start_marker.setMap(null),t(o.options.mapdata).each(function(){this.$marker.setVisible(!0)}),e?(o.$map.setZoom(o.options.zoom),o.$map.panTo(o.options.mapdata[e].latlng)):o.$map.fitBounds(o.$bounds)})},_init_travel_mode:function(){var o=this,e=t("#travel_mode_list_"+o.id);o.$travel_mode=t("#travel_mode_"+o.id),e.on("click","a",function(){var e=t(this);return e.addClass("active").siblings().removeClass("active"),o.$travel_mode.attr("value",e.data("travel-mode")),!1})},_init_gelocation:function(){var t=this;Modernizr.geolocation&&navigator.geolocation.getCurrentPosition(function(o){t.$geocoder.geocode({latLng:new google.maps.LatLng(o.coords.latitude,o.coords.longitude)},function(o,e){e===google.maps.GeocoderStatus.OK&&t.$saddr.val(o[0].formatted_address)})})},_map_resize:function(){var o=this;t(window).on("resize",function(){var t=o.$map.getCenter();google.maps.event.trigger(o.$map,"resize"),o.$map.setCenter(t),o.$route_bounds?o.$map.fitBounds(o.$route_bounds):o.options.mapdata.length>1&&o.$map.fitBounds(o.$bounds)})},_set_markers:function(){var o=this;t(o.options.mapdata).each(function(t){this.$marker=new google.maps.Marker({clickable:!1,icon:this.marker_href?{url:this.marker_href,scaledSize:new google.maps.Size(this.marker_width,this.marker_height)}:e,map:o.$map,optimized:!1,position:this.latlng,zIndex:t}),o.$bounds.extend(this.latlng)}),o.options.mapdata.length>1&&o.$map.fitBounds(o.$bounds)},_limit_zoomlevel:function(){var t=this;0===t.options.max_zoom&&0===t.options.min_zoom||0!==t.options.max_zoom&&0!==t.options.min_zoom&&t.options.max_zoom<t.options.min_zoom||google.maps.event.addDomListener(t.$map,"zoom_changed",function(){0!==t.options.min_zoom&&this.getZoom()<t.options.min_zoom&&this.setZoom(t.options.min_zoom),0!==t.options.max_zoom&&this.getZoom()>t.options.max_zoom&&this.setZoom(t.options.max_zoom)})}},t.fn[i]=function(o){return this.each(function(){t.data(this,"plugin_"+i)||t.data(this,"plugin_"+i,new a(this,o))})}}